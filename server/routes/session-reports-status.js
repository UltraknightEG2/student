const express = require('express');
const router = express.Router();
const SessionReportStatus = require('../models/SessionReportStatus');

// Ø¬Ù„Ø¨ Ø­Ø§Ù„Ø© Ø¥Ø±Ø³Ø§Ù„ Ø§Ù„ØªÙ‚Ø§Ø±ÙŠØ± Ù„Ø¬Ù…ÙŠØ¹ Ø§Ù„Ø­ØµØµ
router.get('/', async (req, res) => {
  try {
    console.log('ğŸ“Š Ø·Ù„Ø¨ Ø¬Ù„Ø¨ Ø­Ø§Ù„Ø© Ø§Ù„ØªÙ‚Ø§Ø±ÙŠØ± Ù„Ø¬Ù…ÙŠØ¹ Ø§Ù„Ø­ØµØµ');
    
    const reportsStatus = await SessionReportStatus.getAll();
    console.log('ğŸ“¡ Ø­Ø§Ù„Ø© Ø§Ù„ØªÙ‚Ø§Ø±ÙŠØ± Ø§Ù„Ù…Ø¬Ù„Ø¨Ø©:', reportsStatus.length, 'Ø¹Ù†ØµØ±');
    
    res.json({
      success: true,
      data: reportsStatus,
      message: 'ØªÙ… Ø¬Ù„Ø¨ Ø­Ø§Ù„Ø© Ø§Ù„ØªÙ‚Ø§Ø±ÙŠØ± Ø¨Ù†Ø¬Ø§Ø­'
    });
  } catch (error) {
    console.error('âŒ Ø®Ø·Ø£ ÙÙŠ Ø¬Ù„Ø¨ Ø­Ø§Ù„Ø© Ø§Ù„ØªÙ‚Ø§Ø±ÙŠØ±:', error);
    res.status(500).json({
      success: false,
      message: 'Ø®Ø·Ø£ ÙÙŠ Ø¬Ù„Ø¨ Ø­Ø§Ù„Ø© Ø§Ù„ØªÙ‚Ø§Ø±ÙŠØ±',
      error: error.message
    });
  }
});

// Ø¬Ù„Ø¨ Ø­Ø§Ù„Ø© Ø¥Ø±Ø³Ø§Ù„ Ø§Ù„ØªÙ‚Ø§Ø±ÙŠØ± Ù„Ø­ØµØ© Ù…Ø¹ÙŠÙ†Ø©
router.get('/:sessionId', async (req, res) => {
  try {
    const { sessionId } = req.params;
    console.log('ğŸ“Š Ø·Ù„Ø¨ Ø¬Ù„Ø¨ Ø­Ø§Ù„Ø© Ø§Ù„ØªÙ‚Ø§Ø±ÙŠØ± Ù„Ù„Ø­ØµØ©:', sessionId);
    
    const reportStatus = await SessionReportStatus.getBySessionId(sessionId);
    
    res.json({
      success: true,
      data: reportStatus,
      message: 'ØªÙ… Ø¬Ù„Ø¨ Ø­Ø§Ù„Ø© Ø§Ù„ØªÙ‚Ø§Ø±ÙŠØ± Ø¨Ù†Ø¬Ø§Ø­'
    });
  } catch (error) {
    console.error('âŒ Ø®Ø·Ø£ ÙÙŠ Ø¬Ù„Ø¨ Ø­Ø§Ù„Ø© Ø§Ù„ØªÙ‚Ø§Ø±ÙŠØ±:', error);
    res.status(500).json({
      success: false,
      message: 'Ø®Ø·Ø£ ÙÙŠ Ø¬Ù„Ø¨ Ø­Ø§Ù„Ø© Ø§Ù„ØªÙ‚Ø§Ø±ÙŠØ±',
      error: error.message
    });
  }
});

// Ø¥Ø¹Ø§Ø¯Ø© ØªØ¹ÙŠÙŠÙ† Ø­Ø§Ù„Ø© Ø¥Ø±Ø³Ø§Ù„ Ø§Ù„ØªÙ‚Ø§Ø±ÙŠØ± (Ù„Ø¥Ø¹Ø§Ø¯Ø© Ø§Ù„Ù…Ø­Ø§ÙˆÙ„Ø©)
router.post('/:sessionId/reset', async (req, res) => {
  try {
    const { sessionId } = req.params;
    console.log('ğŸ”„ Ø¥Ø¹Ø§Ø¯Ø© ØªØ¹ÙŠÙŠÙ† Ø­Ø§Ù„Ø© Ø§Ù„ØªÙ‚Ø§Ø±ÙŠØ± Ù„Ù„Ø­ØµØ©:', sessionId);
    
    const success = await SessionReportStatus.resetReportStatus(sessionId);
    
    if (success) {
      res.json({
        success: true,
        message: 'ØªÙ… Ø¥Ø¹Ø§Ø¯Ø© ØªØ¹ÙŠÙŠÙ† Ø­Ø§Ù„Ø© Ø§Ù„ØªÙ‚Ø§Ø±ÙŠØ± Ø¨Ù†Ø¬Ø§Ø­'
      });
    } else {
      res.status(500).json({
        success: false,
        message: 'ÙØ´Ù„ ÙÙŠ Ø¥Ø¹Ø§Ø¯Ø© ØªØ¹ÙŠÙŠÙ† Ø­Ø§Ù„Ø© Ø§Ù„ØªÙ‚Ø§Ø±ÙŠØ±'
      });
    }
  } catch (error) {
    console.error('âŒ Ø®Ø·Ø£ ÙÙŠ Ø¥Ø¹Ø§Ø¯Ø© ØªØ¹ÙŠÙŠÙ† Ø­Ø§Ù„Ø© Ø§Ù„ØªÙ‚Ø§Ø±ÙŠØ±:', error);
    res.status(500).json({
      success: false,
      message: 'Ø®Ø·Ø£ ÙÙŠ Ø¥Ø¹Ø§Ø¯Ø© ØªØ¹ÙŠÙŠÙ† Ø­Ø§Ù„Ø© Ø§Ù„ØªÙ‚Ø§Ø±ÙŠØ±',
      error: error.message
    });
  }
});

module.exports = router;